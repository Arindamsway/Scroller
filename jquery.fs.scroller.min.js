/*
 * Scroller Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.5.5
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function p(a){for(var a=d.extend({},k,a||{}),b=d(this),c=0,f=b.length;c<f;c++){var e=b.eq(c);if(!e.data("scroller")){var h='<div class="scroller-bar">',h=h+'<div class="scroller-track">',h=h+'<div class="scroller-handle">',h=h+"</div></div></div>";a.paddingRight=parseInt(e.css("padding-right"),10);a.paddingBottom=parseInt(e.css("padding-bottom"),10);e.addClass(a.customClass+" scroller").wrapInner('<div class="scroller-content" />').prepend(h);a.horizontal&&e.addClass("scroller-horizontal"); var g=d.extend({$scrollbar:e,$content:e.find(".scroller-content"),$bar:e.find(".scroller-bar"),$track:e.find(".scroller-track"),$handle:e.find(".scroller-handle")},a);g.$content.on("scroll.scroller",g,l);g.$scrollbar.on("mousedown.scroller",".scroller-track",g,q).on("mousedown.scroller",".scroller-handle",g,r).data("scroller",g);i.reset.apply(e,[g]);d(window).one("load",function(){i.reset.apply(e,[g])})}}return b}function l(a){a.preventDefault();a.stopPropagation();a=a.data;if(!0==a.horizontal){var b= a.$content.scrollLeft();0>b&&(b=0);b/=a.scrollRatio;b>a.handleBounds.right&&(b=a.handleBounds.right);a.$handle.css({left:b})}else b=a.$content.scrollTop(),0>b&&(b=0),b/=a.scrollRatio,b>a.handleBounds.bottom&&(b=a.handleBounds.bottom),a.$handle.css({top:b})}function q(a){a.preventDefault();a.stopPropagation();var b=a.data,c=b.$track.offset();!0==b.horizontal?(b.mouseStart=a.pageX,b.handleLeft=a.pageX-c.left-b.handleWidth/2,j.apply(b.$scrollbar,[b,b.handleLeft])):(b.mouseStart=a.pageY,b.handleTop=a.pageY- c.top-b.handleHeight/2,j.apply(b.$scrollbar,[b,b.handleTop]));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");d("body").on("mousemove.scroller",b,m).on("mouseup.scroller",b,n)}function r(a){a.preventDefault();a.stopPropagation();var b=a.data;!0==b.horizontal?(b.mouseStart=a.pageX,b.handleLeft=parseInt(b.$handle.css("left"),10)):(b.mouseStart=a.pageY,b.handleTop=parseInt(b.$handle.css("top"),10));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");d("body").on("mousemove.scroller", b,m).on("mouseup.scroller",b,n)}function m(a){a.preventDefault();a.stopPropagation();var b=a.data,c=0;!0==b.horizontal?(a=b.mouseStart-a.pageX,c=b.handleLeft-a):(a=b.mouseStart-a.pageY,c=b.handleTop-a);j.apply(b.$scrollbar,[b,c])}function n(a){a.preventDefault();a.stopPropagation();a=a.data;a.$content.on("scroll.scroller",a,l);d("body").off(".scroller")}function j(a,b){if(!0==a.horizontal){b<a.handleBounds.left&&(b=a.handleBounds.left);b>a.handleBounds.right&&(b=a.handleBounds.right);var c=Math.round(b* a.scrollRatio);a.$handle.css({left:b});a.$content.scrollLeft(c)}else b<a.handleBounds.top&&(b=a.handleBounds.top),b>a.handleBounds.bottom&&(b=a.handleBounds.bottom),c=Math.round(b*a.scrollRatio),a.$handle.css({top:b}),a.$content.scrollTop(c)}var k={customClass:"",trackMargin:0,handleSize:!1,horizontal:!1},i={defaults:function(a){k=d.extend(k,a||{});return d(this)},destroy:function(){for(var a=d(this),b=0,c=a.length;b<c;b++){var f=a.eq(b).data("scroller");f&&(f.$scrollbar.removeClass(f.customClass).removeClass("scroller").removeClass("scroller-active"), f.$content.replaceWith(f.$content.html()),f.$bar.remove(),f.$content.unbind("scroll",l),f.$scrollbar.off(".scroller").removeData("scroller"))}return a},scroll:function(a){var b=d(this).data("scroller");"number"!=typeof a&&(a=d(a),0<a.length?(a=a.position(),a=!0==b.horizontal?a.left+b.$content.scrollLeft():a.top+b.$content.scrollTop()):a=b.$content.scrollTop());!0==b.horizontal?b.$content.scrollLeft(a):b.$content.scrollTop(a);return d(this)},reset:function(a){for(var b=d(this),c=0,f=b.length;c<f;c++)if(a= a||b.eq(c).data("scroller"),"undefined"!=typeof a){a.$scrollbar.addClass("scroller-setup");if(!0==a.horizontal)a.barHeight=a.$content[0].offsetHeight-a.$content[0].clientHeight,a.frameWidth=a.$content.outerWidth(),a.trackWidth=a.frameWidth-2*a.trackMargin,a.scrollWidth=a.$content[0].scrollWidth,a.ratio=a.trackWidth/a.scrollWidth,a.trackRatio=a.trackWidth/a.scrollWidth,a.handleWidth=a.handleSize?a.handleSize:a.trackWidth*a.trackRatio,a.scrollRatio=(a.scrollWidth-a.frameWidth)/(a.trackWidth-a.handleWidth), a.handleBounds={left:0,right:a.trackWidth-a.handleWidth},a.$scrollbar.data("scroller",a),a.$content.css({paddingBottom:a.barHeight+a.paddingBottom}),a.$content.scrollLeft(),a.scrollWidth<=a.frameWidth?a.$scrollbar.removeClass("scroller-active"):a.$scrollbar.addClass("scroller-active"),a.$bar.css({width:a.frameWidth}),a.$track.css({width:a.trackWidth,marginLeft:a.trackMargin,marginRight:a.trackMargin}),a.$handle.css({width:a.handleWidth});else{a.barWidth=a.$content[0].offsetWidth-a.$content[0].clientWidth; a.frameHeight=a.$content.outerHeight();a.trackHeight=a.frameHeight-2*a.trackMargin;a.scrollHeight=a.$content[0].scrollHeight;a.ratio=a.trackHeight/a.scrollHeight;a.trackRatio=a.trackHeight/a.scrollHeight;a.handleHeight=a.handleSize?a.handleSize:a.trackHeight*a.trackRatio;a.scrollRatio=(a.scrollHeight-a.frameHeight)/(a.trackHeight-a.handleHeight);a.handleBounds={top:0,bottom:a.trackHeight-a.handleHeight};a.$scrollbar.data("scroller",a);var e=a.$content.scrollTop()*a.ratio;a.scrollHeight<=a.frameHeight? a.$scrollbar.removeClass("scroller-active"):a.$scrollbar.addClass("scroller-active");a.$bar.css({height:a.frameHeight});a.$track.css({height:a.trackHeight,marginBottom:a.trackMargin,marginTop:a.trackMargin});a.$handle.css({height:a.handleHeight})}j.apply(a.$scrollbar,[a,e]);a.$scrollbar.removeClass("scroller-setup")}return b}};d.fn.scroller=function(a){return i[a]?i[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?p.apply(this,arguments):this}})(jQuery);