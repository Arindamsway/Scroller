/*
 * Scroller Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.5.9
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(d){function n(c){for(var b=d.extend({},j,c||{}),c=d(this),a=0,e=c.length;a<e;a++){var f=c.eq(a);if(!f.data("scroller")){var g='<div class="scroller-bar">',g=g+'<div class="scroller-track">',g=g+'<div class="scroller-handle">',g=g+"</div></div></div>";b.paddingRight=parseInt(f.css("padding-right"),10);b.paddingBottom=parseInt(f.css("padding-bottom"),10);f.addClass(b.customClass+" scroller").wrapInner('<div class="scroller-content" />').prepend(g);b.horizontal&&f.addClass("scroller-horizontal"); b=d.extend({$scrollbar:f,$content:f.find(".scroller-content"),$bar:f.find(".scroller-bar"),$track:f.find(".scroller-track"),$handle:f.find(".scroller-handle")},b);b.$content.on("scroll.scroller",b,k);b.$scrollbar.on("mousedown.scroller",".scroller-track",b,p).on("mousedown.scroller",".scroller-handle",b,q).data("scroller",b);h.reset.apply(f,[b]);d(window).one("load",function(){h.reset.apply(f,[b])})}}return c}function k(c){c.preventDefault();c.stopPropagation();c=c.data;if(!0==c.horizontal){var b= c.$content.scrollLeft();0>b&&(b=0);b/=c.scrollRatio;b>c.handleBounds.right&&(b=c.handleBounds.right);c.$handle.css({left:b})}else b=c.$content.scrollTop(),0>b&&(b=0),b/=c.scrollRatio,b>c.handleBounds.bottom&&(b=c.handleBounds.bottom),c.$handle.css({top:b})}function p(c){c.preventDefault();c.stopPropagation();var b=c.data,a=b.$track.offset();!0==b.horizontal?(b.mouseStart=c.pageX,b.handleLeft=c.pageX-a.left-b.handleWidth/2,i.apply(b.$scrollbar,[b,b.handleLeft])):(b.mouseStart=c.pageY,b.handleTop=c.pageY- a.top-b.handleHeight/2,i.apply(b.$scrollbar,[b,b.handleTop]));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");d("body").on("mousemove.scroller",b,l).on("mouseup.scroller",b,m)}function q(c){c.preventDefault();c.stopPropagation();var b=c.data;!0==b.horizontal?(b.mouseStart=c.pageX,b.handleLeft=parseInt(b.$handle.css("left"),10)):(b.mouseStart=c.pageY,b.handleTop=parseInt(b.$handle.css("top"),10));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");d("body").on("mousemove.scroller", b,l).on("mouseup.scroller",b,m)}function l(c){c.preventDefault();c.stopPropagation();var b=c.data,a=0;!0==b.horizontal?(c=b.mouseStart-c.pageX,a=b.handleLeft-c):(c=b.mouseStart-c.pageY,a=b.handleTop-c);i.apply(b.$scrollbar,[b,a])}function m(c){c.preventDefault();c.stopPropagation();c=c.data;c.$content.on("scroll.scroller",c,k);d("body").off(".scroller")}function i(c,b){if(!0==c.horizontal){b<c.handleBounds.left&&(b=c.handleBounds.left);b>c.handleBounds.right&&(b=c.handleBounds.right);var a=Math.round(b* c.scrollRatio);c.$handle.css({left:b});c.$content.scrollLeft(a)}else b<c.handleBounds.top&&(b=c.handleBounds.top),b>c.handleBounds.bottom&&(b=c.handleBounds.bottom),a=Math.round(b*c.scrollRatio),c.$handle.css({top:b}),c.$content.scrollTop(a)}var j={customClass:"",trackMargin:0,handleSize:!1,horizontal:!1},h={defaults:function(c){j=d.extend(j,c||{});return d(this)},destroy:function(){for(var c=d(this),b=0,a=c.length;b<a;b++){var e=c.eq(b).data("scroller");e&&(e.$scrollbar.removeClass(e.customClass).removeClass("scroller").removeClass("scroller-active"), e.$content.replaceWith(e.$content.html()),e.$bar.remove(),e.$content.unbind("scroll",k),e.$scrollbar.off(".scroller").removeData("scroller"))}return c},scroll:function(c){var b=d(this).data("scroller");"number"!=typeof c&&(c=d(c),0<c.length?(c=c.position(),c=!0==b.horizontal?c.left+b.$content.scrollLeft():c.top+b.$content.scrollTop()):c=b.$content.scrollTop());!0==b.horizontal?b.$content.scrollLeft(c):b.$content.scrollTop(c);return d(this)},reset:function(c){for(var b=d(this),a,e=0,f=b.length;e<f;e++)if(a= c||b.eq(e).data("scroller"),"undefined"!=typeof a){a.$scrollbar.addClass("scroller-setup");if(!0==a.horizontal)a.barHeight=a.$content[0].offsetHeight-a.$content[0].clientHeight,a.frameWidth=a.$content.outerWidth(),a.trackWidth=a.frameWidth-2*a.trackMargin,a.scrollWidth=a.$content[0].scrollWidth,a.ratio=a.trackWidth/a.scrollWidth,a.trackRatio=a.trackWidth/a.scrollWidth,a.handleWidth=a.handleSize?a.handleSize:a.trackWidth*a.trackRatio,a.scrollRatio=(a.scrollWidth-a.frameWidth)/(a.trackWidth-a.handleWidth), a.handleBounds={left:0,right:a.trackWidth-a.handleWidth},a.$scrollbar.data("scroller",a),a.$content.css({paddingBottom:a.barHeight+a.paddingBottom}),a.$content.scrollLeft(),a.scrollWidth<=a.frameWidth?a.$scrollbar.removeClass("scroller-active"):a.$scrollbar.addClass("scroller-active"),a.$bar.css({width:a.frameWidth}),a.$track.css({width:a.trackWidth,marginLeft:a.trackMargin,marginRight:a.trackMargin}),a.$handle.css({width:a.handleWidth});else{a.barWidth=a.$content[0].offsetWidth-a.$content[0].clientWidth; a.frameHeight=a.$content.outerHeight();a.trackHeight=a.frameHeight-2*a.trackMargin;a.scrollHeight=a.$content[0].scrollHeight;a.ratio=a.trackHeight/a.scrollHeight;a.trackRatio=a.trackHeight/a.scrollHeight;a.handleHeight=a.handleSize?a.handleSize:a.trackHeight*a.trackRatio;a.scrollRatio=(a.scrollHeight-a.frameHeight)/(a.trackHeight-a.handleHeight);a.handleBounds={top:0,bottom:a.trackHeight-a.handleHeight};a.$scrollbar.data("scroller",a);var g=a.$content.scrollTop()*a.ratio;a.scrollHeight<=a.frameHeight? a.$scrollbar.removeClass("scroller-active"):a.$scrollbar.addClass("scroller-active");a.$bar.css({height:a.frameHeight});a.$track.css({height:a.trackHeight,marginBottom:a.trackMargin,marginTop:a.trackMargin});a.$handle.css({height:a.handleHeight})}i.apply(a.$scrollbar,[a,g]);a.$scrollbar.removeClass("scroller-setup")}return b}};d.fn.scroller=function(c){return h[c]?h[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof c||!c?n.apply(this,arguments):this}})(jQuery);