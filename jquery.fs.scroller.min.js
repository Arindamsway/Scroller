/*
 * Scroller Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.5.3
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(e){function n(a){for(var a=e.extend({},i,a||{}),b=e(this),c=0,f=b.length;c<f;c++){var d=b.eq(c);if(!d.data("scroller")){var g='<div class="scroller-bar">',g=g+'<div class="scroller-track">',g=g+'<div class="scroller-handle">',g=g+"</div></div></div>";a.paddingRight=parseInt(d.css("padding-right"),10);a.paddingBottom=parseInt(d.css("padding-bottom"),10);d.addClass(a.customClass+" scroller").wrapInner('<div class="scroller-content" />').prepend(g);a.horizontal&&d.addClass("scroller-horizontal"); d=e.extend({$scrollbar:d,$content:d.find(".scroller-content"),$bar:d.find(".scroller-bar"),$track:d.find(".scroller-track"),$handle:d.find(".scroller-handle")},a);d.$content.on("scroll.scroller",d,j);d.$scrollbar.on("mousedown.scroller",".scroller-track",d,p).on("mousedown.scroller",".scroller-handle",d,q).data("scroller",d);k.reset.apply(this,[d])}}return b}function j(a){a.preventDefault();a.stopPropagation();a=a.data;if(!0==a.horizontal){var b=a.$content.scrollLeft();0>b&&(b=0);b/=a.scrollRatio; b>a.handleBounds.right&&(b=a.handleBounds.right);a.$handle.css({left:b})}else b=a.$content.scrollTop(),0>b&&(b=0),b/=a.scrollRatio,b>a.handleBounds.bottom&&(b=a.handleBounds.bottom),a.$handle.css({top:b})}function p(a){a.preventDefault();a.stopPropagation();var b=a.data,c=b.$track.offset();!0==b.horizontal?(b.mouseStart=a.pageX,b.handleLeft=a.pageX-c.left-b.handleWidth/2,h.apply(b.$scrollbar,[b,b.handleLeft])):(b.mouseStart=a.pageY,b.handleTop=a.pageY-c.top-b.handleHeight/2,h.apply(b.$scrollbar,[b, b.handleTop]));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");e("body").on("mousemove.scroller",b,l).on("mouseup.scroller",b,m)}function q(a){a.preventDefault();a.stopPropagation();var b=a.data;!0==b.horizontal?(b.mouseStart=a.pageX,b.handleLeft=parseInt(b.$handle.css("left"),10)):(b.mouseStart=a.pageY,b.handleTop=parseInt(b.$handle.css("top"),10));b.$scrollbar.data("scroller",b);b.$content.off(".scroller");e("body").on("mousemove.scroller",b,l).on("mouseup.scroller",b,m)}function l(a){a.preventDefault(); a.stopPropagation();var b=a.data,c=0;!0==b.horizontal?(a=b.mouseStart-a.pageX,c=b.handleLeft-a):(a=b.mouseStart-a.pageY,c=b.handleTop-a);h.apply(b.$scrollbar,[b,c])}function m(a){a.preventDefault();a.stopPropagation();a=a.data;a.$content.on("scroll.scroller",a,j);e("body").off(".scroller")}function h(a,b){if(!0==a.horizontal){b<a.handleBounds.left&&(b=a.handleBounds.left);b>a.handleBounds.right&&(b=a.handleBounds.right);var c=Math.round(b*a.scrollRatio);a.$handle.css({left:b});a.$content.scrollLeft(c)}else b< a.handleBounds.top&&(b=a.handleBounds.top),b>a.handleBounds.bottom&&(b=a.handleBounds.bottom),c=Math.round(b*a.scrollRatio),a.$handle.css({top:b}),a.$content.scrollTop(c)}var i={customClass:"",trackMargin:0,handleSize:!1,horizontal:!1},k={defaults:function(a){i=e.extend(i,a||{});return e(this)},destroy:function(){for(var a=e(this),b=0,c=a.length;b<c;b++){var f=a.eq(b).data("scroller");f&&(f.$scrollbar.removeClass(f.customClass).removeClass("scroller").removeClass("scroller-active"),f.$content.replaceWith(f.$content.html()), f.$bar.remove(),f.$content.unbind("scroll",j),f.$scrollbar.off(".scroller").removeData("scroller"))}return a},scroll:function(a){var b=e(this).data("scroller");"number"!=typeof a&&(a=e(a),0<a.length?(a=a.position(),a=!0==b.horizontal?a.left+b.$content.scrollLeft():a.top+b.$content.scrollTop()):a=b.$content.scrollTop());!0==b.horizontal?b.$content.scrollLeft(a):b.$content.scrollTop(a);return e(this)},reset:function(a){for(var b=e(this),c=0,f=b.length;c<f;c++)if(a=a||b.eq(c).data("scroller"),"undefined"!= typeof a){a.$scrollbar.addClass("scroller-setup");if(!0==a.horizontal)a.barHeight=a.$content[0].offsetHeight-a.$content[0].clientHeight,a.frameWidth=a.$content.outerWidth(),a.trackWidth=a.frameWidth-2*a.trackMargin,a.scrollWidth=a.$content[0].scrollWidth,a.ratio=a.trackWidth/a.scrollWidth,a.trackRatio=a.trackWidth/a.scrollWidth,a.handleWidth=a.handleSize?a.handleSize:a.trackWidth*a.trackRatio,a.scrollRatio=(a.scrollWidth-a.frameWidth)/(a.trackWidth-a.handleWidth),a.handleBounds={left:0,right:a.trackWidth- a.handleWidth},a.$scrollbar.data("scroller",a),a.$content.css({paddingBottom:a.barHeight+a.paddingBottom}),a.$content.scrollLeft(),a.scrollWidth<=a.frameWidth?a.$scrollbar.removeClass("scroller-active"):a.$scrollbar.addClass("scroller-active"),a.$bar.css({width:a.frameWidth}),a.$track.css({width:a.trackWidth,marginLeft:a.trackMargin,marginRight:a.trackMargin}),a.$handle.css({width:a.handleWidth});else{a.barWidth=a.$content[0].offsetWidth-a.$content[0].clientWidth;a.frameHeight=a.$content.outerHeight(); a.trackHeight=a.frameHeight-2*a.trackMargin;a.scrollHeight=a.$content[0].scrollHeight;a.ratio=a.trackHeight/a.scrollHeight;a.trackRatio=a.trackHeight/a.scrollHeight;a.handleHeight=a.handleSize?a.handleSize:a.trackHeight*a.trackRatio;a.scrollRatio=(a.scrollHeight-a.frameHeight)/(a.trackHeight-a.handleHeight);a.handleBounds={top:0,bottom:a.trackHeight-a.handleHeight};a.$scrollbar.data("scroller",a);var d=a.$content.scrollTop()*a.ratio;a.scrollHeight<=a.frameHeight?a.$scrollbar.removeClass("scroller-active"): a.$scrollbar.addClass("scroller-active");a.$bar.css({height:a.frameHeight});a.$track.css({height:a.trackHeight,marginBottom:a.trackMargin,marginTop:a.trackMargin});a.$handle.css({height:a.handleHeight})}h.apply(a.$scrollbar,[a,d]);a.$scrollbar.removeClass("scroller-setup")}return b}};e.fn.scroller=function(a){return k[a]?k[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?n.apply(this,arguments):this}})(jQuery);